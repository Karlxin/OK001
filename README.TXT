1.目标:	
	
2.实现：

3.问题：
	
4.原因：

5.尝试：

6.现象: 1.遥控映射15度,xy角度p值4,z,p值0
	1.1p,r,角速度P值0.02，y 0.01:遥控控制的角度晃动过大
	1.2p,r,角速度p值0.06,y,0.03:锁住的角度范围大概在正负两度,视频编号20170331_141416.mp4
	1.3p,r,角速度p值0.05,y,0.025,:锁住的角度范围大概在正负一度,pitch前倾,yaw头依旧向右,视频编号:20170331_143349.mp4
	1.4p,r,角速度p值0.05,y,0.04,明显比上一个不稳,视频:20170331_144814.mp4
	1.5p,r,角速度p值0.05,y,0,都向右yaw一百八十多度了视频：20170331_150950.mp4

	2.遥控映射15度,xy角度p值4,z,p值2
	2.1p,r,角速度p值0.05,y,0,yaw虽然好一点点了,但是还是不稳呀视频:20170331_152335.mp4

	3.遥控映射15度,xyz角度p值4
	3.1x,y角速度p值0.05,z,0,角度明显锁住了，但是还是不稳呀，视频:20170331_153835.mp4

	4.x,y角速度p值0.05,z,0
	4.1遥控映射15度,xyz角度p值3.5,第一次在地面刚起来roll在摆动,第二次也是摆来摆去，但有那么一段时间特别稳.视频：20170331_155647.mp4

	5.角速度x,y,0.05,z,0.025;遥控映射15度,角度xyz值3.5,起飞摆动不明显了,但是还是不稳呀.视频:20170331_161401.mp4

	6.角速度x,y,0,z,0;
	6.1遥控映射15度,角度xyz值3.5,直接损坏四号浆,视频:2017_0331_170552.mp4,20170331_170631.mp4
	6.2遥控映射15度,角度xyz值1,反应很迟钝,不好控制,视频:20170331_171951.mp4
	
	7.角速度xy0.05,z,0.025角度xyz3,没有自摆动了,视频:20170331_173617.mp4,20170331_175259.mp4
	
	8.
	8.1加入Z轴加速度负反馈,0.09乘以6值滑动滤波Z轴加计值,很吓人,油门乱飘,视频：20170331_191601.mp4
	8.2使用IIR低通滤波,5ms,10Hz.把值0.09减小到三分之一,乘以6值滑动滤波Z轴加计值,依旧狂暴,且直接推油门会猛冲上天,电池脱落,还伤了我手,视频:20170331_195610.mp4
	
	9.以下每步都要录像
	9.1取消Z轴加速度负反馈,看是否还能像以前一样飞,可以飞，但是不好控制了。theta_xyz_3,omega_xy_0.05,omega_z_0.025视频:20170402_190111.mp4

	9.2加入油门顶值，不让其超过1700,这个时候加速度已经很大了,即加入一个油门限制函数,if油门>1780,返回1780,没有拍视频,这一步没有改变p值

	9.3跟随理论的步伐，利用MATLAB来最优化P值吧,MATLAB指示,角度3，角速度0.17是个很好的值,且指示在角度3的基础上，角速度从0.05一直往上加都可以减小调整时间,考虑铝管计算得到roll方向p_1为3,p_2为0.25可以达到很好效果,考虑铝管计算得到pitch方向p_1为3，p_2为0.22可以达到很好效果,这里考虑的角速度是以度为单位的，roll方向最终可以控制最多500的油门0.25*2000=500;故我的roll方向p_2实际应该是0.0152588,pitch方向为0.0134277.或者我通过omega/32768*2000得到以度计算的角速度,好的，显然先直接用0.0152588比较好,yaw能控制400油门,故yaw为0.0122070,或者转换角度后为0.2,看来apm也是用的2000度每秒量程.xyz_theta_3,x_omega_0.0152588,y_omega_0.0134277,z_omega_0.0122070,控制起来倒是很好了，但是太好控制了，反而幅度有点大.视频:20170402_191818
	9.3.1根据理论推断，我应该加大陀螺仪的值，那就翻一倍吧,xyz_theta_3,x_omega_0.03,y_omega_0.03,z_omega_0.025,重心在前面.视频:20170402_193253.mp4
	9.3.2看这摆动情况，还是小咯，那就再加个0.006,重心调了调，吧,xyz_theta_3,x_omega_0.036,y_omega_0.036,z_omega_0.025,总的来说还是不错的，但是偶尔也会不太好控制,视频:20170402_200748

	9.4油门最下时不允许反馈控制,避免故障时继续转,即通过if函数此时直接调用最底层全部输出0，且所有还能调用最底层的次底层禁止,将角速度转换为度计量再传递进控制函数，这一步将值放到PD控制器的D处预先乘好了，此一步必须记录视频,xyz_theta_3,x_omega_0.6,y_omega_0.6,z_omega_0.39,(此值与上一步未转换的一致),这一步之后，理论仿真能更方便地和实践结合了,就是roll方向有振荡，需要加大,视频:20170403_091336.mp4

	9.5xyz_theta_3,x_omega_0.8,y_omega_0.6,z_omega_0.39,看看roll是否振荡,如果振荡说明转动惯量确实大,完全不能控制roll方向了,视频:20170403_094930.mp4

	9.6xyz_theta_3,x_omega_0.7,y_omega_0.6,z_omega_0.39,yaw有点往右了,但是摆动不明显了，也好操控一点了,视频：20170403_102521.mp4

	9.7xyz_theta_3
	9.7.1x_omega_0.7,y_omega_0.6,z_omega_0.5,有一点点yaw,视频:20170403_110126.mp4
	9.7.2x_omega_0.7,y_omega_0.6,z_omega_0.6,感觉上yaw好多了,可能Z轴转动惯量挺大的吧,但还是有点锁不住，有时候,视频:20170403_124112.mp4
	9.7.3x_omega_0.7,y_omega_0.6,z_omega_0.7,果然Z轴惯量太大，APM的参数是有道理的.视频:20170403_125342.mp4

	10.加了很多东西啦,也改了很多东西,就是有点奇怪，视频:20170405_151232.mp4,视频:20170405_151327.mp4
	

7.解决: 

8.异常:

PS:    
	1.小心Altitude有可能是0或者无穷大,或者是负值,这都是要考虑哒
	2.匿名4.06pitch方向是反的，要小心	
	3.只有油门在预估悬停位时(工程悬停区)，才让自动悬停，且可控油门不超过工程悬停区。
	4.气压计的变化敏感比测量看起来更准确
	5.气压速度与加速度计速度闭环控加锁速
	6.限制油门1700以下,且必须保证安全，油门放最下时必须停止所有.
	7.悬停区间1550~1600，允许Z轴定速,且进入此区间前飞机必须要能起飞。
	8.加入Z轴后，首先观察在接近油门中位时油门变化情况，是否狂躁